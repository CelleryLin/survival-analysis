<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HCC 肝癌存活分析系統 - 資料輸入</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .card {
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .form-label {
      font-weight: 500;
    }
    .required-field::after {
      content: " *";
      color: red;
    }
    .form-control, .form-select {
      font-size: 14px;
    }
    .col-md-6 {
      margin-bottom: 15px;
    }
    .error-message {
  color: #dc3545;
  font-size: 12px;
  margin-top: 5px;
  display: none;
    }
    .form-control.error {
      border-color: #dc3545;
    }
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .bg-primary {
      background-color: #125497 !important; 
    }

    .language-switch {
      position: relative;
    }
    .category-header {
      background: linear-gradient(135deg, #1979d9, #8ac4ff);
      color: white;
      padding: 10px 15px;
      margin: 20px 0 15px 0;
      border-radius: 8px;
      font-weight: 600;
    }
    
    /* 背景圖片 Logo 樣式 */
    .bg-logo {
      position: relative;
      padding-left: 20px;
      overflow: visible;
    }

    .bg-logo::before {
      content: '';
      position: absolute;
      left: -45px;  /* 改为固定像素值 */
      top: 90%;
      transform: translateY(-50%);
      width: 140px;  /* 圖片寬度 */
      height: 140px;  /* 圖片高度，可以超出導航欄 */
      background-image: url('logo.png');
      background-repeat: no-repeat;
      background-size: contain;
      background-position: center;
      z-index: 1;
    }
    .bg-logo .ms-5 {
      position: relative;
      z-index: 1; /* 確保文字在上方 */
      top: 10px; /* 向下移動10px，可以調整數值 */
    }

    .navbar {
      overflow: visible; /* 重要！讓內容可以超出 */
    }
      </style>
</head>
<body class="bg-light">
  <!-- 載入覆蓋層 -->
  <div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="text-center">
      <div class="spinner-border text-primary" role="status"></div>
      <div class="mt-2" data-i18n="loading">分析中，請稍候...</div>
    </div>
  </div>

  <!-- 頁面標頭 -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand bg-logo" href="#">
        <span class="ms-5" data-i18n="systemName">肝癌存活分析系統</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" href="#" data-i18n="home">首頁</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" id="navAbout" data-i18n="aboutSystem">關於系統</a>
          </li>
          <li class="nav-item language-switch">
            <select class="form-select form-select-sm" id="languageSelector">
              <option value="zh">中文</option>
              <option value="en">English</option>
            </select>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- 輸入表單頁面 -->
  <div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-12">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h4 class="mb-0" data-i18n="patientDataInput">患者資料輸入</h4>
          </div>
          <div class="card-body">
            <form id="patientForm">
              
              <!-- Demographics -->
              <div class="category-header">
                <h5 class="mb-0" data-i18n="demographics">Demographics (人口統計學資料)</h5>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <label class="form-label" data-i18n="patientName">病患姓名</label>
                  <input type="text" name="name" id="patientName" class="form-control">
                </div>
                <div class="col-md-6">
                  <label class="form-label required-field" data-i18n="sex">Sex (性別)</label>
                  <select name="Sex" id="Sex" class="form-select" required>
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="M" data-i18n="male">男性</option>
                    <option value="F" data-i18n="female">女性</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label required-field" data-i18n="age">Age (年齡)</label>
                  <input type="number" name="Age" id="Age" class="form-control" required>
                </div>
                <div class="error-message" id="ageError">Age must be between 0 and 150</div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="bmi">Body Mass Index (身體質量指數)</label>
                  <input type="number" name="BMI" id="BMI" class="form-control" step="0.1">
  
                </div>
                <div class="error-message" id="bmiError">BMI must be between 10 and 50</div>
              </div>

              <!-- Etiology -->
              <div class="category-header">
                <h5 class="mb-0" data-i18n="etiology">Etiology (病因學)</h5>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <label class="form-label" data-i18n="hbv">HBV (B型肝炎)</label>
                  <select name="HBV" id="HBV" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">陽性</option>
                    <option value="No">陰性</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="hcv">HCV (C型肝炎)</label>
                  <select name="HCV" id="HCV" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">陽性</option>
                    <option value="No">陰性</option>
                  </select>
                </div>
              </div>

              <!-- Tumor Characteristics -->
              <div class="category-header">
                <h5 class="mb-0" data-i18n="tumorCharacteristics">Tumor Characteristics (腫瘤特徵)</h5>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <label class="form-label" data-i18n="maximal_tumor_size">Maximal Tumor Size (最大腫瘤大小) cm</label>
                  <input type="number" name="Maximal_tumor_size" id="Maximal_tumor_size" class="form-control" step="0.1">
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="tumor_number">Tumor Number (腫瘤數量)</label>
                  <input type="number" name="Tumor_number" id="Tumor_number" class="form-control">
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="tumor_distribution">Tumor Distribution (腫瘤分布)</label>
                  <select name="Tumor_distribution" id="Tumor_distribution" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Unilobar">Unilobar (單葉)</option>
                    <option value="Bilobar">Bilobar (雙葉)</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="lymphonodules">Lymphonodules (淋巴結)</label>
                  <select name="Lymphonodules" id="Lymphonodules" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="metastasis">Metastasis (轉移)</label>
                  <select name="Metastasis" id="Metastasis" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="ehs">EHS (肝外轉移)</label>
                  <select name="EHSM" id="EHSM" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="mvi">MVI (微血管侵犯)</label>
                  <select name="MVI" id="MVI" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
              </div>

              <!-- Disease Stage -->
              <div class="category-header">
                <h5 class="mb-0" data-i18n="diseaseStage">Disease Stage (疾病分期)</h5>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <label class="form-label" data-i18n="bclc_stage">BCLC Stage (BCLC分期)</label>
                  <select name="BCLC_stage" id="BCLC_stage" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="0">0 (Very early stage)</option>
                    <option value="A">A (Early stage)</option>
                    <option value="B">B (Intermediate stage)</option>
                    <option value="C">C (Advanced stage)</option>
                    <option value="D">D (Terminal stage)</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="ps">Performance Status (體能狀態)</label>
                  <select name="PS" id="PS" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="0">0 (完全活動能力)</option>
                    <option value="1">1 (限制費力活動)</option>
                    <option value="2">2 (能自理但不能工作)</option>
                    <option value="3">3 (有限自理能力)</option>
                    <option value="4">4 (完全失能)</option>
                  </select>
                </div>
              </div>
<!-- Liver Function -->
              <div class="category-header">
                <h5 class="mb-0" data-i18n="liverFunction">Liver Function (肝功能)</h5>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <label class="form-label" data-i18n="cirrhosis">Cirrhosis (肝硬化)</label>
                  <select name="Cirrhosis" id="Cirrhosis" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="childpugh_class">Child-Pugh Class (Child-Pugh分級)</label>
                  <select name="ChildPugh_class" id="ChildPugh_class" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="A">A (5-6分)</option>
                    <option value="B">B (7-9分)</option>
                    <option value="C">C (10-15分)</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="ascites">Ascites (腹水)</label>
                  <select name="Ascites" id="Ascites" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="encephalopathy">Encephalopathy (肝性腦病)</label>
                  <select name="Encephalopathy" id="Encephalopathy" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
              </div>

              <!-- Laboratory Values -->
              <div class="category-header">
                <h5 class="mb-0" data-i18n="laboratoryValues">Laboratory Values (實驗室數值)</h5>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <label class="form-label" data-i18n="afp">AFP (甲型胎兒蛋白) ng/mL</label>
                  <input type="number" name="AFP" id="AFP" class="form-control" step="0.01">
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="total_bilirubin">Total Bilirubin (總膽紅素) mg/dL</label>
                  <input type="number" name="Total_bilirubin" id="Total_bilirubin" class="form-control" step="0.01">
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="inr">INR (國際標準化比值)</label>
                  <input type="number" name="INR" id="INR" class="form-control" step="0.01">
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="albumin">Albumin (白蛋白) g/dL</label>
                  <input type="number" name="Albumin" id="Albumin" class="form-control" step="0.1">
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="gpt">GPT (麩丙酮酸轉胺酶) U/L</label>
                  <input type="number" name="GPT" id="GPT" class="form-control">
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="creatinine">Creatinine (肌酸酐) mg/dL</label>
                  <input type="number" name="Creatine" id="Creatine" class="form-control" step="0.01">
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="hemoglobin">Hemoglobin (血紅素) g/dL</label>
                  <input type="number" name="Hemoglobin" id="Hemoglobin" class="form-control" step="0.1">
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="platelet_count">Platelet Count (血小板計數) ×10³/μL</label>
                  <input type="number" name="Platelet_count" id="Platelet_count" class="form-control">
                </div>
              </div>

              <!-- Comorbidities -->
              <div class="category-header">
                <h5 class="mb-0" data-i18n="comorbidities">Comorbidities (共病症)</h5>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <label class="form-label" data-i18n="dm">DM (糖尿病)</label>
                  <select name="DM" id="DM" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="htn">HTN (高血壓)</label>
                  <select name="HTN" id="HTN" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="esrd">ESRD (末期腎病)</label>
                  <select name="ESRD" id="ESRD" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="ckd">CKD (慢性腎病)</label>
                  <select name="CKD" id="CKD" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
              </div>
              
              <!-- Treatment Methods -->
              <div class="category-header">
                <h5 class="mb-0" data-i18n="treatmentMethods">Treatment Methods (治療方式)</h5>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <label class="form-label" data-i18n="liver_transplantation">Liver Transplantation (肝臟移植)</label>
                  <select name="Liver_transplantation" id="Liver_transplantation" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="surgical_resection">Surgical Resection (手術切除)</label>
                  <select name="Surgical_resection" id="Surgical_resection" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="radiofrequency">Radiofrequency Ablation (射頻消融)</label>
                  <select name="Radiofrequency" id="Radiofrequency" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="tace">TACE (經導管動脈化療栓塞)</label>
                  <select name="TACE" id="TACE" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="target_therapy">Target Therapy (標靶治療)</label>
                  <select name="Target_therapy" id="Target_therapy" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="immunotherapy">Immunotherapy (免疫治療)</label>
                  <select name="Immunotherapy" id="Immunotherapy" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="haic">HAIC (肝動脈灌注化療)</label>
                  <select name="HAIC" id="HAIC" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="radiotherapy">Radiotherapy (放射治療)</label>
                  <select name="Radiotherapy" id="Radiotherapy" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="best_support_care">Best Supportive Care (最佳支持治療)</label>
                  <select name="Best_support_care" id="Best_support_care" class="form-select">
                    <option value="" data-i18n="pleaseSelect">請選擇</option>
                    <option value="Yes">有</option>
                    <option value="No">無</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" data-i18n="hospital">Hospital (醫院)</label>
                  <input type="text" name="Hospital" id="Hospital" class="form-control">
                </div>
              </div>
              
              <hr>
              <p class="text-muted small" data-i18n="requiredFieldNote">* 表示必填欄位 (年齡、性別)</p>
              
              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary btn-lg" data-i18n="startAnalysis">開始分析</button>
              </div>
            </form>
          </div>
        </div>
        
        <div class="card bg-light">
          <div class="card-body">
            <h5 data-i18n="instructions">使用說明</h5>
            <ul>
              <li data-i18n="instruction1">請輸入病患相關資訊進行肝癌存活率分析</li>
              <li data-i18n="instruction2">年齡和性別為必填項目</li>
              <li data-i18n="instruction3">分析結果僅供醫療參考，不應替代專業醫師診斷</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- 確認模態框 -->
<div class="modal fade" id="confirmModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" data-i18n="confirmModalTitle">確認提交</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p data-i18n="confirmMessage">您有超過50%的欄位未填寫，以下是未填寫的項目：</p>
        <div id="missingFields" class="mb-3"></div>
        <p data-i18n="confirmQuestion">是否確定要繼續分析？</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="cancel">取消</button>
        <button type="button" class="btn btn-primary" id="confirmSubmit" data-i18n="confirmContinue">確定繼續</button>
      </div>
    </div>
  </div>
</div>

  <!-- 關於系統模態框 -->
  <div class="modal fade" id="aboutModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="aboutModalTitle">關於肝癌存活分析系統</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <h6 data-i18n="systemOverview">系統概述</h6>
          <p data-i18n="systemOverviewContent">肝癌存活分析系統是一個基於機器學習演算法開發的臨床決策輔助工具，旨在協助醫療專業人員評估肝癌患者的預後情況。</p>
          
          <h6 data-i18n="modelDescription">模型說明</h6>
          <p data-i18n="modelDescriptionContent">此預測模型使用40項臨床指標作為輸入變數，包括：年齡、性別、BMI、腫瘤大小、AFP值、肝功能指標等。</p>
          
          <h6 data-i18n="notes">注意事項</h6>
          <p data-i18n="notesContent">本系統僅作為臨床決策的輔助工具，不應替代專業醫師的診斷和治療建議。</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="close">關閉</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 頁腳 -->
  <footer class="bg-primary text-white mt-4 py-3">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <p class="mb-0">© 2025 <span data-i18n="systemNameFooter">肝癌存活分析系統</span></p>
        </div>
        <div class="col-md-6 text-md-end">
          <p class="mb-0" data-i18n="forMedicalUse">僅供醫療專業人員使用</p>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 語言翻譯物件
    const translations = {
      zh: {
        systemName: "HCC 肝癌存活分析系統",
        loading: "分析中，請稍候...",
        home: "首頁",
        aboutSystem: "關於系統",
        patientDataInput: "患者資料輸入",
        demographics: "Demographics (人口統計學資料)",
        patientName: "病患姓名",
        age: "Age (年齡)",
        sex: "Sex (性別)",
        pleaseSelect: "請選擇",
        male: "男性",
        female: "女性",
        bmi: "Body Mass Index (身體質量指數)",
        etiology: "Etiology (病因學)",
        hbv: "HBV (B型肝炎)",
        hcv: "HCV (C型肝炎)",
        tumorCharacteristics: "Tumor Characteristics (腫瘤特徵)",
        maximal_tumor_size: "Maximal Tumor Size (最大腫瘤大小) cm",
        tumor_number: "Tumor Number (腫瘤數量)",
        tumor_distribution: "Tumor Distribution (腫瘤分布)",
        lymphonodules: "Lymphonodules (淋巴結)",
        metastasis: "Metastasis (轉移)",
        ehs: "EHS (肝外轉移)",
        mvi: "MVI (微血管侵犯)",
        diseaseStage: "Disease Stage (疾病分期)",
        bclc_stage: "BCLC Stage (BCLC分期)",
        ps: "Performance Status (體能狀態)",
        liverFunction: "Liver Function (肝功能)",
        cirrhosis: "Cirrhosis (肝硬化)",
        childpugh_class: "Child-Pugh Class (Child-Pugh分級)",
        ascites: "Ascites (腹水)",
        encephalopathy: "Encephalopathy (肝性腦病)",
        laboratoryValues: "Laboratory Values (實驗室數值)",
        afp: "AFP (甲型胎兒蛋白) ng/mL",
        total_bilirubin: "Total Bilirubin (總膽紅素) mg/dL",
        inr: "INR (國際標準化比值)",
        albumin: "Albumin (白蛋白) g/dL",
        gpt: "GPT (麩丙酮酸轉胺酶) U/L",
        creatinine: "Creatinine (肌酸酐) mg/dL",
        hemoglobin: "Hemoglobin (血紅素) g/dL",
        platelet_count: "Platelet Count (血小板計數) ×10³/μL",
        comorbidities: "Comorbidities (共病症)",
        dm: "DM (糖尿病)",
        htn: "HTN (高blood pressure)",
        esrd: "ESRD (末期腎病)",
        ckd: "CKD (慢性腎病)",
        treatmentMethods: "Treatment Methods (治療方式)",
        liver_transplantation: "Liver Transplantation (肝臟移植)",
        surgical_resection: "Surgical Resection (手術切除)",
        radiofrequency: "Radiofrequency Ablation (射頻消融)",
        tace: "TACE (經導管動脈化療栓塞)",
        target_therapy: "Target Therapy (標靶治療)",
        immunotherapy: "Immunotherapy (免疫治療)",
        haic: "HAIC (肝動脈灌注化療)",
        radiotherapy: "Radiotherapy (放射治療)",
        best_support_care: "Best Supportive Care (最佳支持治療)",
        hospital: "Hospital (醫院)",
        requiredFieldNote: "* 表示必填欄位 (年齡、性別)",
        startAnalysis: "開始分析",
        instructions: "使用說明",
        instruction1: "請輸入病患相關資訊進行肝癌存活率分析",
        instruction2: "年齡和性別為必填項目",
        instruction3: "分析結果僅供醫療參考，不應替代專業醫師診斷",
        aboutModalTitle: "關於肝癌存活分析系統",
        systemOverview: "系統概述",
        systemOverviewContent: "肝癌存活分析系統是一個基於機器學習演算法開發的臨床決策輔助工具，旨在協助醫療專業人員評估肝癌患者的預後情況。",
        modelDescription: "模型說明",
        modelDescriptionContent: "此預測模型使用40項臨床指標作為輸入變數，包括：年齡、性別、BMI、腫瘤大小、AFP值、肝功能指標等。",
        notes: "注意事項",
        notesContent: "本系統僅作為臨床決策的輔助工具，不應替代專業醫師的診斷和治療建議。",
        close: "關閉",
        systemNameFooter: "肝癌存活分析系統",
        forMedicalUse: "僅供醫療專業人員使用",
        ageError: "年齡必須介於 0 到 150 歲之間",
        bmiError: "BMI必須介於 10 到 50 之間",
        confirmModalTitle: "確認提交",
        confirmMessage: "您有超過50%的欄位未填寫，以下是未填寫的項目：",
        confirmQuestion: "是否確定要繼續分析？",
        cancel: "取消",
        confirmContinue: "確定繼續"

      },
      en: {
        systemName: "HCC Liver Cancer Survival Analysis System",
        loading: "Analyzing, please wait...",
        home: "Home",
        aboutSystem: "About",
        patientDataInput: "Patient Data Input",
        demographics: "Demographics",
        patientName: "Patient Name",
        age: "Age",
        sex: "Sex",
        pleaseSelect: "Please select",
        male: "Male",
        female: "Female",
        bmi: "Body Mass Index",
        etiology: "Etiology",
        hbv: "HBV (Hepatitis B)",
        hcv: "HCV (Hepatitis C)",
        tumorCharacteristics: "Tumor Characteristics",
        maximal_tumor_size: "Maximal Tumor Size (cm)",
        tumor_number: "Tumor Number",
        tumor_distribution: "Tumor Distribution",
        lymphonodules: "Lymph Nodes",
        metastasis: "Metastasis",
        ehs: "EHS (Extrahepatic Metastases)",
        mvi: "MVI (Microvascular Invasion)",
        diseaseStage: "Disease Stage",
        bclc_stage: "BCLC Stage",
        ps: "Performance Status",
        liverFunction: "Liver Function",
        cirrhosis: "Cirrhosis",
        childpugh_class: "Child-Pugh Class",
        ascites: "Ascites",
        encephalopathy: "Encephalopathy",
        laboratoryValues: "Laboratory Values",
        afp: "AFP (ng/mL)",
        total_bilirubin: "Total Bilirubin (mg/dL)",
        inr: "INR",
        albumin: "Albumin (g/dL)",
        gpt: "GPT (U/L)",
        creatinine: "Creatinine (mg/dL)",
        hemoglobin: "Hemoglobin (g/dL)",
        platelet_count: "Platelet Count (×10³/μL)",
        comorbidities: "Comorbidities",
        dm: "DM (Diabetes Mellitus)",
        htn: "HTN (Hypertension)",
        esrd: "ESRD (End-Stage Renal Disease)",
        ckd: "CKD (Chronic Kidney Disease)",
        treatmentMethods: "Treatment Methods",
        liver_transplantation: "Liver Transplantation",
        surgical_resection: "Surgical Resection",
        radiofrequency: "Radiofrequency Ablation",
        tace: "TACE",
        target_therapy: "Target Therapy",
        immunotherapy: "Immunotherapy",
        haic: "HAIC",
        radiotherapy: "Radiotherapy",
        best_support_care: "Best Supportive Care",
        hospital: "Hospital",
        requiredFieldNote: "* indicates required fields (Age, Sex)",
        startAnalysis: "Start Analysis",
        instructions: "Instructions",
        instruction1: "Please enter patient information for liver cancer survival analysis",
        instruction2: "Age and sex are required fields",
        instruction3: "Analysis results are for medical reference only",
        aboutModalTitle: "About Liver Cancer Survival Analysis System",
        systemOverview: "System Overview",
        systemOverviewContent: "Clinical decision support tool based on machine learning algorithms.",
        modelDescription: "Model Description",
        modelDescriptionContent: "Uses 40 clinical indicators as input variables.",
        notes: "Notes",
        notesContent: "This system is a clinical decision support tool only.",
        close: "Close",
        systemNameFooter: "HCC Liver Cancer Survival Analysis System",
        forMedicalUse: "For medical professionals only",
        ageError: "Age must be between 0 and 150",
        bmiError: "BMI must be between 10 and 50",
        confirmModalTitle: "Confirm Submission",
        confirmMessage: "More than 50% of fields are not filled. Missing fields:",
        confirmQuestion: "Are you sure you want to continue?",
        cancel: "Cancel",
        confirmContinue: "Continue"
      }
    };
    
    // 切換語言函數
    function switchLanguage(lang) {
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang][key]) {
          element.textContent = translations[lang][key];
        }
      });
      
      // 儲存語言偏好 (注意：不使用 localStorage)
      // localStorage.setItem('preferredLanguage', lang);
      
      // 更新頁面語言屬性
      document.documentElement.lang = lang === 'zh' ? 'zh-Hant' : 'en';
    }

    // 數值驗證函數
    function validateNumericInput(inputId, min, max, errorId) {
      const input = document.getElementById(inputId);
      const errorDiv = document.getElementById(errorId);
      const value = parseFloat(input.value);
      
      if (input.value && (isNaN(value) || value < min || value > max)) {
        input.classList.add('error');
        errorDiv.style.display = 'block';
        return false;
      } else {
        input.classList.remove('error');
        errorDiv.style.display = 'none';
        return true;
      }
    }
    
    // 初始化
    document.addEventListener('DOMContentLoaded', function() {
      const patientForm = document.getElementById('patientForm');
      const loadingOverlay = document.getElementById('loadingOverlay');
      const navAbout = document.getElementById('navAbout');
      const aboutModal = new bootstrap.Modal(document.getElementById('aboutModal'));
      const languageSelector = document.getElementById('languageSelector');
      
      // 檢查未填寫欄位的函數
      function checkMissingFields() {
        const allFields = patientForm.querySelectorAll('input, select');
        const missingFields = [];
        const fieldLabels = {};
        
        // 建立欄位標籤對應
        allFields.forEach(field => {
          const label = patientForm.querySelector(`label[for="${field.id}"]`);
          if (label) {
            fieldLabels[field.name] = label.textContent.replace(' *', '');
          }
        });
        
        // 檢查必填欄位
        const requiredFields = ['Age', 'Sex'];
        for (let fieldName of requiredFields) {
          const field = patientForm.querySelector(`[name="${fieldName}"]`);
          if (!field.value.trim()) {
            missingFields.push(fieldLabels[fieldName] || fieldName);
          }
        }
        
        // 檢查非必填欄位
        allFields.forEach(field => {
          if (field.name && field.name !== 'name' && !requiredFields.includes(field.name)) {
            if (!field.value.trim()) {
              missingFields.push(fieldLabels[field.name] || field.name);
            }
          }
        });
        
        return missingFields;
      }

      const confirmModal = new bootstrap.Modal(document.getElementById('confirmModal'));

      // 讀取儲存的語言偏好
      // const savedLang = localStorage.getItem('preferredLanguage') || 'zh';
      const savedLang = 'zh'; // 預設中文
      languageSelector.value = savedLang;
      switchLanguage(savedLang);
      
      // 語言切換事件
      languageSelector.addEventListener('change', function() {
        switchLanguage(this.value);
      });
      
      // 關於頁面連結
      navAbout.addEventListener('click', function(e) {
        e.preventDefault();
        aboutModal.show();
      });
      // 添加即時驗證
      document.getElementById('Age').addEventListener('input', function() {
        validateNumericInput('Age', 0, 150, 'ageError');
      });

      document.getElementById('BMI').addEventListener('input', function() {
        validateNumericInput('BMI', 10, 50, 'bmiError');
      });
// 表單提交處理
patientForm.addEventListener('submit', function(e) {
  e.preventDefault();
  
  // 驗證數值範圍
  const isAgeValid = validateNumericInput('Age', 0, 150, 'ageError');
  const isBmiValid = validateNumericInput('BMI', 10, 50, 'bmiError');

  if (!isAgeValid || !isBmiValid) {
    return;
  }
  
  // 檢查未填寫欄位
  const missingFields = checkMissingFields();
  const totalFields = patientForm.querySelectorAll('input, select').length - 1; // 扣除姓名欄位
  const missingPercentage = (missingFields.length / totalFields) * 100;
  
  if (missingPercentage > 50) {
    // 顯示未填寫欄位
    const missingFieldsDiv = document.getElementById('missingFields');
    missingFieldsDiv.innerHTML = '<ul class="list-unstyled">' + 
      missingFields.map(field => `<li>• ${field}</li>`).join('') + 
      '</ul>';
    confirmModal.show();
    return;
  }
  
  // 直接提交
  submitForm();
});

// 確認提交按鈕事件
document.getElementById('confirmSubmit').addEventListener('click', function() {
  confirmModal.hide();
  submitForm();
});

// 提交表單函數
function submitForm() {
  // 顯示載入中
  loadingOverlay.style.display = 'flex';
  
  // 收集所有表單數據
  const formData = new FormData(patientForm);
  const dataObject = {};
  
  // 轉換為物件
  for (let [key, value] of formData.entries()) {
    dataObject[key] = value || '';
  }
  
  // 儲存當前語言設定
  dataObject.preferredLanguage = languageSelector.value;
  
  // 使用 sessionStorage 儲存數據
  sessionStorage.setItem('patientData', JSON.stringify(dataObject));
  
  // 延遲一秒後跳轉（模擬載入效果）
  setTimeout(function() {
    window.location.href = 'analysis.html';
  }, 1000);
};
    });
  </script>
</body>
</html>